<script>
  (function() {
    Polymer.Base.originalPolymerCreatedCallback =
        Polymer.Base.createdCallback;
    Polymer.Base.createdCallback = function() {
      if (this.__isPolymerDart__) return;
      this.originalPolymerCreatedCallback();
    };

    var originalAttachedCallback = Polymer.Base.attachedCallback;
    Polymer.Base.attachedCallback = function() {
      originalAttachedCallback.call(this);
      if (this.__dartAttached__) this.__dartAttached__();
    };

    var originalDetachedCallback = Polymer.Base.detachedCallback;
    Polymer.Base.detachedCallback = function() {
      if (originalDetachedCallback) originalDetachedCallback.call(this);
      if (this.__dartDetached__) this.__dartDetached__();
    };

    var originalDeserialize = Polymer.Base.deserialize;
    Polymer.Base.deserialize = function(value, type) {
      console.log('deserialize!');
      if (this.__dartDeserialize__) {
        var result = this.__dartDeserialize__(value, type);
        if (result) return result;
      }
      if (originalDeserialize) return originalDeserialize.call(this, value, type);
    };

    var originalSerialize = Polymer.Base.serialize;
    Polymer.Base.serialize = function(value) {
      console.log('serialize!');
      if (this.__dartSerialize__) {
        var result = this.__dartSerialize__(value);
        if (result) return result;
      }
      if (originalSerialize) return originalSerialize.call(this, value);
    };

    Polymer.Dart = {};
    // Used to get an empty constructor function which doesn't call into dart.
    Polymer.Dart.functionFactory = function() { return function() {}; };
    // Generates a function which accesses a particular property on a dart
    // class
    Polymer.Dart.propertyAccessorFactory = function(property, dartGetter) {
      return function() {
        if (this.__cache__) return this.__cache__[property];
        return dartGetter(this.__dartClass__);
      };
    };
    // Generates a function which sets a particular property on a dart class.
    Polymer.Dart.propertySetterFactory = function(property, dartSetter) {
      return function(value) {
        if (this.__cache__) this.__cache__[property] = value;
        dartSetter(this.__dartClass__, value);
      };
    };
    // Generates a function which invokes a dart function with this or the
    // __dartClass__ proxy if it exists as the first argument, and all other
    // arguments as the second argument.
    Polymer.Dart.invokeDartFactory = function(dartFunction) {
      return function() {
        var thisArg = this.__dartClass__ ? this.__dartClass__ : this;
        // Must convert `arguments` to an actual array that the js side can
        // recognize.
        var args = [];
        for (var i = 0; i < arguments.length; i++) {
          args[i] = arguments[i];
        }
        return dartFunction(thisArg, args);
      }
    };
  })();
</script>
